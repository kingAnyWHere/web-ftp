<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><meta name="viewport" content="width=640,user-scalable=no"><title>Web-Ftp | By 摘星fy</title><link rel="shortcut icon" type="image/x-icon" href="http://codding.cn/ftp-favicon.ico"><link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><style>*{padding:0;margin:0;font:inherit;color:inherit;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-overflow-scrolling:touch}body{background:#d3d6d9;-overflow-y:scroll}li,ul{list-style:none}table{width:100%}table.align td:nth-child(2n-1){width:10px;white-space:nowrap}table.align td{padding:4px}.fl{float:left}.fr{float:right}.vm{display:inline-block;height:100%;vertical-align:middle}.c{text-anchor:center}.ellipsis{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.glyphicon{cursor:pointer}.form-control{-webkit-appearance:none}.modal{display:block;background:rgba(0,0,0,.5);overflow:auto}.modal-header .glyphicon{top:3px}#web-ftp .dir-list{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}#web-ftp .dir-list .dir{width:300px;height:300px;position:absolute;left:20px;top:20px;background:#fff;box-shadow:0 0 10px rgba(0,0,0,.2);border-radius:4px;overflow:hidden;transition:.3s all;margin-bottom:5em}#web-ftp .dir-list .dir .gray-title{background:#f1f1f1;height:34px;border-bottom:1px solid #ddd;padding:.5em .5em 0 .5em;cursor:move}#web-ftp .dir-list .dir .gray-title .fr{margin-left:.3em}#web-ftp .dir-list .dir .gray-title .fr .glyphicon{margin-left:.3em}#web-ftp .dir-list .dir .gray-title .path-box{overflow:hidden}#web-ftp .dir-list .dir .gray-title .path-box .form-control{padding:0;height:1.5em;line-height:1.5em;border-radius:0;text-indent:0;background:0 0;border-color:transparent;box-shadow:none;cursor:inherit;transition:.15s all}#web-ftp .dir-list .dir .gray-title .path-box .form-control:focus{background:#fff;border-color:#ddd;text-indent:.2em;cursor:text}#web-ftp .dir-list .dir .auto-scroll{position:absolute;left:0;top:34px;right:0;bottom:0;overflow:auto;z-index:1}#web-ftp .dir-list .dir .auto-scroll .file-list{text-align:center;word-break:break-all;padding-bottom:5em;overflow:hidden;margin-bottom:0;min-height:100%;padding-right:5px}#web-ftp .dir-list .dir .auto-scroll .file-list .file{width:75px;height:75px;float:left;margin:5px 0 0 5px;padding-top:.4em;border:1px solid transparent}#web-ftp .dir-list .dir .auto-scroll .file-list .file:hover{background:#e5f3ff}#web-ftp .dir-list .dir .auto-scroll .file-list .file:active{background:#d8eaff}#web-ftp .dir-list .dir .auto-scroll .file-list .file[draggable=true]{background:#ddd;border-color:#ccc}#web-ftp .dir-list .dir .auto-scroll .file-list .file .glyphicon{font-size:28px;cursor:inherit}#web-ftp .dir-list .dir .auto-scroll .file-list .file[is-dir=true] .glyphicon:before{color:#fd5}#web-ftp .dir-list .dir .auto-scroll .file-list .file .file-name{line-height:1.4em;max-height:2.8em;font-size:12px;overflow:hidden;padding:0 .2em;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2}#web-ftp .dir-list .dir.cur .auto-scroll .file-list .file[draggable=true]{background:#cce8ff;border-color:#99d1ff}#web-ftp .dir-list .dir.dragover{background:#f3f6f9}#web-ftp .dir-list .dir .auto-scroll .file-list .file.cut{opacity:.75}#web-ftp .dir-list .dir .resize>div>div{width:6px;height:6px;position:absolute;left:0;top:0;background:url(http://codding.cn/blank.php);z-index:2}#web-ftp .dir-list .dir .resize .line .l{height:100%;cursor:w-resize}#web-ftp .dir-list .dir .resize .line .t{width:100%;cursor:n-resize}#web-ftp .dir-list .dir .resize .line .r{height:100%;left:auto;right:0;cursor:e-resize}#web-ftp .dir-list .dir .resize .line .b{width:100%;top:auto;bottom:0;cursor:s-resize}#web-ftp .dir-list .dir .resize .corner>div{width:12px;height:12px}#web-ftp .dir-list .dir .resize .corner .lt{cursor:nw-resize}#web-ftp .dir-list .dir .resize .corner .rt{left:auto;right:0;cursor:ne-resize}#web-ftp .dir-list .dir .resize .corner .rb{left:auto;right:0;top:auto;bottom:0;cursor:se-resize}#web-ftp .dir-list .dir .resize .corner .lb{top:auto;bottom:0;cursor:sw-resize}#web-ftp .select-rect{width:100px;height:100px;position:absolute;left:50px;top:50px;background:rgba(0,170,255,.5);border:1px solid #09f}#web-ftp .ctrl-btn{position:fixed;right:20px;bottom:20px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}#web-ftp .ctrl-btn .btn{margin-left:5px}#modal-config .app-list section{margin-bottom:20px}#modal-config .app-list section:last-child{margin-bottom:0}#modal-config .app-list section table .text-right .btn{margin-left:5px}#table-upload-err-report td{padding:3px 0}#table-upload-err-report td:nth-child(2n-1){text-align:right}@keyframes loading-rotate-x{0%{transform:rotateY(0)}100%{transform:rotateY(360deg)}}@keyframes loading-rotate-y{0%{transform:rotateX(0)}100%{transform:rotateX(360deg)}}#loading{width:100%;height:100%;position:fixed;left:0;top:0;background:radial-gradient(rgba(0,0,0,.3),rgba(0,0,0,.75));display:-webkit-box;-webkit-box-pack:center;white-space:nowrap;-webkit-box-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;transform-style:preserve-3d;transform:perspective(600px)}#loading *{transform-style:preserve-3d}#loading .box{text-align:center;color:#fff;-background:rgba(255,0,0,.2)}#loading .box .ball{width:60px;height:60px;position:relative;background:-rgba(0,0,0,.2);margin-bottom:10px;z-index:10;transform:rotate(-45deg)}#loading .box .ball ul,#loading .box .ball ul li{width:100%;height:100%;position:absolute;left:0;top:0}#loading .box .ball ul li{border:1px solid #fff;border-radius:50%}#loading .box .ball ul.h{animation:4s loading-rotate-y linear infinite}#loading .box .ball ul.v{animation:4s loading-rotate-x linear infinite}.free-view{width:100%;height:100%;position:fixed;left:0;top:0;background:rgba(0,0,0,.9);display:flex;flex-direction:column;color:#ddd}.free-view .topbar{width:100%;height:50px;background:#111;position:relative;z-index:2}.free-view .topbar .fr{height:100%;font-size:1.5em}.free-view .topbar .fr .glyphicon{border-left:1px solid #444;padding:0 1em;float:left;height:49px;line-height:49px}.free-view .topbar .pathname{padding:0 1em;line-height:50px}.free-view .img-view{width:100%;position:absolute;top:55px;bottom:80px;text-align-last:center;vertical-align:middle;white-space:nowrap}.free-view .img-view img{flex:1;max-width:100%;max-height:100%}.free-view .thumb-list{height:80px;overflow:hidden;width:100%;height:80px;position:absolute;left:0;bottom:0}.free-view .thumb-list ul{white-space:nowrap;position:absolute;left:50%;top:5px;margin-left:-35px}.free-view .thumb-list ul li{width:70px;height:70px;display:inline-block;margin-right:5px;border:1px solid #ccc;opacity:.5;background:#fff no-repeat center/cover}.free-view .thumb-list ul li.on{opacity:1}#menu{min-width:80px;position:fixed;left:50px;top:100px;z-index:100;background:#fff;border-radius:4px;box-shadow:0 4px 15px rgba(0,0,0,.3);color:#555;white-space:nowrap;display:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none}#menu ul{padding:8px 0;margin-bottom:0}#menu ul li{padding:4px 15px;cursor:pointer}#menu ul li:hover{background:#337ab7;color:#fff}.fade-enter-active{animation:fade-in .4s}.fade-leave-active{animation:fade-in .3s reverse}@keyframes fade-in{0%{opacity:0}100%{opacity:1}}</style></head><body style="display: none"><div id="web-ftp"><div class="dir-list"><section v-for="(dirItem, dirIdx) in dirList" :class="['dir', {cur: dirIdx === curDirIndex}]" :key="'dir-'+ dirItem.uid" :dir-index="dirIdx" :style="dirItem.css"><div class="gray-title"><div class="fr"><span>{{getFiles(dirItem).length}}</span> <i class="glyphicon glyphicon-pencil" onclick="$(this).closest('.gray-title').find('.form-control').focus()"></i> <i class="glyphicon glyphicon-remove" @click="dirList.splice(dirIdx, 1)"></i></div><div class="path-box"><input type="text" class="form-control" :value="dirItem.path" @keydown.stop.enter="updateDirPath($event,dirItem)"></div></div><div class="auto-scroll"><div style="margin: 10px; overflow: hidden" class="alert alert-danger" v-if="getUrlReport(curApp).code || getFiles(dirItem).code">{{getUrlReport(curApp).msg || getFiles(dirItem).msg}}</div><ul class="file-list" v-else><li class="file" v-for="(file, idx) in getFiles(dirItem)" :key="curApp.url + '-' + curApp.secretKey + '-' + idx + '-' + file.name " :filename="file.name" :filetype="file.type" :basename="file.basename" :file-index="idx" :is-dir="file.isDir" :title="'名称：'+file.name+(file.isDir ? '' : '\n日期：'+file._mtime)"><i :class="['glyphicon', 'glyphicon-' + (file.isDir ? 'folder-close' : (mapType[file.type] || 'file'))]" draggable="true"></i><div class="file-name" draggable="true">{{file.name}}</div></li></ul></div><div class="resize"><div class="line"><div class="l"></div><div class="t"></div><div class="r"></div><div class="b"></div></div><div class="corner"><div class="lt"></div><div class="rt"></div><div class="rb"></div><div class="lb"></div></div></div></section></div><div class="select-rect" style="display: none"></div><div id="menu" :style="{zIndex: zIndex + 1}"><ul><li v-for="(command, idx) in menu.list" v-if="command" :command="command" @click="exec($event,command)">{{command}}</li></ul></div><!-- 控制按钮 --><ctrl-btn></ctrl-btn><!-- 重命名 --><transition name="fade"><modal-rename v-if="rename.isDisplay"></modal-rename></transition><!-- 新建文件夹 --><transition name="fade"><modal-new-dir v-if="router.newDir.isDisplay"></modal-new-dir></transition><!-- 打开文件夹 --><transition name="fade"><modal-open-dir v-if="router.open.isDisplay"></modal-open-dir></transition><!-- free-view --><transition name="fade"><free-view v-if="freeView.imgList.length > 0"></free-view></transition><!-- 配置面板 --><transition name="fade"><modal-config v-if="router.config.isDisplay"></modal-config></transition><!-- 弹出层 --><transition name="fade"><panel-alert v-if="alert.isDisplay"></panel-alert></transition><!-- upload --><transition name="fade"><upload v-if="upload.isUploading || upload.errReport.length > 0"></upload></transition><!-- loading --><!-- <transition name="fade">
    <loading 
      v-show="is.loading"
    ></loading>
  </transition> --><!-- <div id="cmd" style="position: fixed; right: 20px; top: 20px; z-index: 1000; max-width: 50%;">
    <pre>{{router}}</pre>
  </div> --></div><script>function bug(msg) {
    console.log(msg)
  }</script><script src="https://cdn.bootcss.com/crypto-js/3.1.9/crypto-js.min.js"></script><script src="https://cdn.bootcss.com/crypto-js/3.1.9/hmac-sha256.min.js"></script><script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.0/vue.min.js"></script><script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><script>var g={is:{mac:navigator.userAgent.indexOf("Mac OS")>-1},json2URL(t){let e=[];for(let i in t)e.push(i+"="+encodeURIComponent("object"==typeof t[i]?JSON.stringify(t[i]):t[i]));return e.join("&")},urlFormat:t=>t.replace(/(\\|\/)+/g,"/").replace(/\/$/,""),createUid:()=>parseInt(Math.random().toString().replace("0.","")).toString(36),isCtrlKey:t=>g.is.mac?t.metaKey:t.ctrlKey,getReport(t){return this.g.urlReport[t.url+"-"+t.secretKey]||{}},dirname:t=>t.replace(/\/[^/]*$/,""),getFileFromDataTransfer(t,e){function i(t){t.isFile?t.file(function(i){i.fullPath=t.fullPath,l.push(i),r&&clearTimeout(r),r=setTimeout(function(){e&&e(l)},300)}):t.isDirectory&&t.createReader().readEntries(function(t){Array.prototype.slice.call(t).forEach(i)})}if(0===t.files.length)return[];let r=0,l=[];Array.prototype.slice.call(t.items).forEach(function(t){"file"===t.kind&&i(t.webkitGetAsEntry())})}};!Array.prototype.fill&&(Array.prototype.fill=function(t,e,i){e=e||0,i=i||this.length-1,e=(e%this.length+this.length)%this.length,i=(i%this.length+this.length)%this.length;const r=Math.max(e,i),l=Math.min(e,i);for(let e=r;e<=l;e++)this[e]=t;return this}),Number.prototype.fill0=function(t){let e=this.toString();for(t=t||2;e.length<t;)e="0"+e;return e},Date.prototype.date=function(t){let e={y:this.getFullYear().fill0(),m:(this.getMonth()+1).fill0(),d:this.getDate().fill0(),h:this.getHours().fill0(),i:this.getMinutes().fill0(),s:this.getSeconds().fill0()};return(t||"y-m-d h:i:s").replace(/y|m|d|h|i|s/g,t=>e[t])},document.body.closest&&($.prototype.closest=function(t){return this.map((e,i)=>i.closest(t))}),$.fn.extend({mousewheel(t){return this.on("onmousewheel"in document?"mousewheel":"DOMMouseScroll",e=>{const i=e.originalEvent.wheelDelta<0||e.detail>0;t&&t.call(this,e,i)}),this}}),$(window).on("scroll",t=>{$("#menu").hide()});</script><script>Vue.component("ctrl-btn",{template:`\n    <div class="ctrl-btn"\n      :style="{zIndex: $root.zIndex + 5}"\n    >\n      <a href="javascript:" class="btn btn-success"\n        @click="$root.router.open.isDisplay=true"\n        v-if="$root.getUrlReport($root.curApp).secretVal"\n      >\n        <i class="glyphicon glyphicon-folder-open"></i>\n        <span>打开</span>\n      </a>\n      <a href="javascript:" class="btn btn-warning"\n        @click="$root.router.config.isDisplay=true"\n      >\n        <i class="glyphicon glyphicon-cog"></i>\n        <span>配置</span>\n      </a>\n    </div>\n  `}),Vue.component("modal-rename",{template:`\n    <div class="modal fade in"\n      :style="{zIndex: $root.zIndex + 10}"\n      @click="$root.rename.isDisplay=false"\n    >\n      <form class="modal-dialog" \n        @click.stop\n        @submit.prevent="$root.submitRename"\n      >\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">\n              <i class="glyphicon glyphicon-info-sign"></i>\n              <span>重命名</span>\n            </h4>\n          </div>\n          <div class="modal-body">\n            <input type="text" placeholder="输入文件名" class="form-control" \n              v-model="$root.rename.name"\n              @input="$root.debounce=500;"\n            />\n          </div>\n          <div class="modal-footer">\n            <input type="submit" value="新建" class="btn btn-success btn-block" />\n          </div>\n        </div>\n      </form>\n    </div>\n  `}),Vue.component("modal-new-dir",{template:`\n    <div class="modal fade in"\n      :style="{zIndex: $root.zIndex + 10}"\n      @click="$root.router.newDir.isDisplay=false"\n    >\n      <form class="modal-dialog" \n        @click.stop\n        @submit.prevent="submitNewDir"\n      >\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">\n              <i class="glyphicon glyphicon-info-sign"></i>\n              <span>新建文件夹</span>\n            </h4>\n          </div>\n          <div class="modal-body">\n            <div class="alert alert-info">\n              <span>在 {{$root.dir.path}} 下创建文件夹</span>\n            </div>\n            <input type="text" placeholder="输入名称" class="form-control" \n              v-model="$root.router.newDir.name"\n              @input="$root.debounce=500;"\n            />\n          </div>\n          <div class="modal-footer">\n            <input type="submit" value="新建" class="btn btn-success btn-block" />\n          </div>\n        </div>\n      </form>\n    </div>\n  `,methods:{submitNewDir(n){const e=this.$root,t=(e.getWrapFilesKey(e.dir),e.getUrlReport(e.curApp)),o=e.urlFormat(e.dir.path+"/"+e.router.newDir.name);e.debounce=1,$.post(e.curApp.url,{a:"新建文件夹",secretVal:t.secretVal,fullPath:o},n=>{e.router.newDir.name.indexOf("/")>-1&&(e.dir.path=o),e.path2File={},e.router.newDir.name=""}),e.router.newDir.isDisplay=!1}}}),Vue.component("modal-open-dir",{template:`\n    <div class="modal fade in"\n      :style="{zIndex: $root.zIndex + 10}"\n      @click="$root.router.open.isDisplay=false"\n    >\n      <form class="modal-dialog"\n        @click.stop\n        @submit.prevent="submitOpenDir"\n      >\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">\n              <i class="glyphicon glyphicon-info-sign"></i>\n              <span>打开文件夹</span>\n            </h4>\n          </div>\n          <div class="modal-body">\n            <div class="alert alert-info">\n              <span>当前远程地址：{{$root.curApp.url}}</span>\n            </div>\n            <input type="text" placeholder="输入路径" class="form-control" \n              v-model="$root.router.open.path"\n              @input="$root.debounce=500;"\n            />\n          </div>\n          <div class="modal-footer">\n            <input type="submit" value="打开" class="btn btn-success btn-block" />\n          </div>\n        </div>\n      </form>\n    </div>\n  `,methods:{submitOpenDir(){const n=this.$root;$("html,body").animate({scrollTop:0}),n.debounce=0,n.dirList.push({path:n.urlFormat(n.router.open.path),sortBy:"0",uid:g.createUid(),css:{left:"100px",top:"100px",width:"400px",height:"400px",zIndex:n.zIndex}}),n.curDirIndex=n.dirList.length-1,n.router.open.isDisplay=!1,n.router.open.path=""}}}),Vue.component("modal-config",{template:`\n    <div id="modal-config" class="modal fade in"\n      :style="{zIndex: $root.zIndex + 10}"\n      @click="$root.router.config.isDisplay=false"\n    >\n      <form class="modal-dialog" @click.stop>\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">\n              <i class="glyphicon glyphicon-info-sign"></i>\n              <span>配置</span>\n            </h4>\n          </div>\n          <div class="modal-body">\n            <div class="app-list">\n              <section v-for="(appItem, appIdx) in $root.appList">\n                <table class="align">\n                  <tr>\n                    <td>\n                      <input type="text" class="form-control"\n                        placeholder="输入地址" \n                        :value="appItem.url"\n                        @input="$root.debounce=500;appItem.url=$event.target.value"\n                      >\n                    </td>\n                  </tr>\n                  <tr>\n                    <td>\n                      <input :type="appItem.eye ? 'text' : 'password'" class="form-control"\n                        placeholder="输入秘钥" \n                        :value="appItem.secretKey"\n                        @input="$root.debounce=500;appItem.secretKey=$event.target.value"\n                      >\n                    </td>\n                  </tr>\n                  <tr>\n                    <td class="text-right">\n                      <div class="alert alert-danger text-left" style="margin-bottom: 8px;"\n                        v-if="$root.getUrlReport(appItem).code"\n                        @keydown.stop\n                      >{{$root.getUrlReport(appItem).msg}}</div>\n                      <div>\n                        <span class="btn btn-info btn-xs"\n                          v-if="$root.getUrlReport(appItem).isLoading"\n                        >loading...</span>\x3c!-- \n                     --\x3e<span class="btn btn-success btn-xs"\n                          v-if="$root.getUrlReport(appItem).secretVal"\n                        >接口正常</span>\x3c!-- \n                     --\x3e<a href="javascript:" class="btn btn-danger btn-xs"\n                          @click.prevent="$root.appList.splice(appIdx,1)"\n                          v-if="$root.appList.length > 1"\n                        >\n                          <i class="glyphicon glyphicon-trash"></i>\n                        </a>\x3c!-- \n                     --\x3e<a href="javascript:" class="btn btn-warning btn-xs"\n                          @click.prevent="$root.appList.splice(appIdx+1,0,{'url': '','eye': false,'curDirIndex': 0,'secretKey': '','dirList': []})"\n                        >\n                          <i class="glyphicon glyphicon-plus"></i>\n                        </a>\x3c!-- \n                     --\x3e<a href="javascript:" \n                          :class="['btn', 'btn-' + (appItem.eye ? 'info' : 'default'), 'btn-xs']"\n                          @click.prevent="appItem.eye=!appItem.eye"\n                        >\n                          <i :class="['glyphicon', 'glyphicon-eye-' + (appItem.eye ? 'open' : 'close')]"></i>\n                        </a>\x3c!-- \n                     --\x3e<a href="javascript:" \n                          :class="['btn', 'btn-'+ ($root.router.config.curAppIndex===appIdx?'success':'default'), 'btn-xs']"\n                          @click.prevent="$root.router.config.curAppIndex=appIdx;$root.router.config.isDisplay=false;"\n                        >\n                          <i class="glyphicon glyphicon-ok"></i>\n                        </a>\n                      </div>\n                    </td>\n                  </tr>\n                </table>\n              </section>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <a href="http://codding.cn/webFtp.php?a=downloadExec" class="btn btn-primary">\n              <i class="glyphicon glyphicon-download"></i>\n              <span>下载php接口文件</span>\n            </a>\n          </div>\n        </div>\n      </form>\n    </div>\n  `}),Vue.component("free-view",{template:`\n    <div class="free-view"\n      :style="{zIndex: $root.zIndex + 10}"\n    >\n      <div class="topbar">\n        <div class="fr">\n          <i class="glyphicon glyphicon-repeat" @click="setRotate"></i>\n          <i class="glyphicon glyphicon-download-alt" @click="downloadPic"></i>\n          <i class="glyphicon glyphicon-remove" @click="closeFreeView"></i>\n        </div>\n        <div class="pathname ellipsis">\n          <span>当前查看： {{$root.freeView.imgList[curIndex].name}}</span>\n        </div>\n      </div>\n      <div class="img-view">\n        <img class="big-img" alt="" \n          :src="getSrc(curIndex)"\n          :style="{transform: 'translate('+$root.freeView.left+'px, '+$root.freeView.top+'px) scale('+$root.freeView.scale+') rotate('+(rotate*90)+'deg)'}"\n        /><div class="vm"></div>\n      </div>\n      <div class="thumb-list">\n        <ul>\n          <li\n            v-for="(item, idx) in $root.freeView.imgList"\n            :style="{backgroundImage: 'url('+getSrc(idx)+')', transform: 'translateX(-'+(curIndex * 75)+'px)'}"\n            :class="{on: idx === curIndex}"\n            @click="curIndex = idx"\n          ></li>\n        </ul>\n      </div>\n    </div>\n  `,data:()=>({timerTransition:0}),computed:{curIndex:{get(){const n=this.$root.freeView,e=n.curIndex,t=n.imgList.length;return n.left=0,n.top=0,n.rotate=0,n.scale=1,(e%t+t)%t},set(n){this.$root.freeView.curIndex=n}},rotate:{get(){return this.$root.freeView.rotate},set(n){this.$root.freeView.rotate++}}},methods:{getSrc(n){const e=this.$root,t=e.freeView,o=e.curApp,i=e.dir,s=e.getUrlReport(o);return o.url+"?"+g.json2URL({a:"读取文件",secretVal:s.secretVal,fullPath:i.path+"/"+t.imgList[n].name})},setRotate(){const n=this,e=$(n.$el).find(".big-img").css("transition",".3s all");n.rotate++,clearTimeout(n.timerTransition),n.timerTransition=setTimeout(()=>{e.css("transition","none")},350)},removeOnePic(n){const e=this,t=e.$root,o=t.freeView,i=t.getFiles(t.dir),s=e.curIndex,l=o.imgList;l.splice(s,1);for(let n=0,e=i.length;n<e;n++)if(i[n]===l[s])return void i.splice(n,1)},downloadPic(n){const e=this,t=e.$root,o=t.freeView,i=t.curApp,s=t.getUrlReport(i);location.href=i.url+"?"+g.json2URL({a:"下载",secretVal:s.secretVal,pathDir:t.dir.path,filenames:[o.imgList[e.curIndex].name]})},closeFreeView(n){this.$root.freeView.imgList=[]}},mounted(){const n=this,e=n.$root.freeView;n.$nextTick(()=>{$(this.$el).find(".big-img").on("mousedown",n=>{const t=n.clientX,o=n.clientY,i=e.left,s=e.top;n.preventDefault(),document.onmousemove=(n=>{const l=n.clientX,a=n.clientY;e.left=l-t+i,e.top=a-o+s}),document.onmouseup=(n=>{document.onmousemove=document.onmouseup=null;n.clientX,n.clientY})}).mousewheel((n,t)=>{n.preventDefault(),t?e.scale/=1.2:e.scale*=1.2}).end().find(".thumb-list").mousewheel((e,t)=>{e.preventDefault(),t?n.curIndex++:n.curIndex--})})}}),Vue.component("upload",{template:`\n    <div class="modal fade in"\n      :style="{zIndex: $root.zIndex + 10}"\n      @click="hideUpload($event)"\n    >\n      <div class="modal-dialog" @click.stop>\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title ellipsis">\n              <i class="glyphicon glyphicon-info-sign"></i>\n              <span>文件上传</span>\n              <small class="text-info">{{$root.dir.path}}</small>\n            </h4>\n          </div>\n          <div class="modal-body">\n            <div class="progress">\n              <div class="progress-bar progress-bar-success progress-bar-striped"\n                :style="{width: (($root.upload.sizeUploading + $root.upload.sizeUploaded) / $root.upload.sizeTotal * 100) + '%'}"\n              ></div>\n            </div>\n            <div class="msg" v-if="$root.upload.msg">{{$root.upload.msg}}</div>\n            <div v-if="($root.upload.errReport || []).length > 0"\n              style="max-height: 60vh; overflow: auto; margin-top: 15px;"\n            >\n              <table id="table-upload-err-report">\n                <tr v-for="(item, idx) in $root.upload.errReport">\n                  <td class="ellipsis" style="width: 10px; max-width: 150px; vertical-align: top;">{{item.name}}：</td>\n                  <td style="word-break: break-all;"><span class="text-danger">{{item.msg}}</span></td>\n                </tr>\n              </table>\n            </div>\n          </div>\n          <div class="modal-footer">\n            <div class="btn btn-warning btn-block" \n              @click="$root.blankBinaryFiles"\n            >{{$root.upload.isUploading ? '取消' : '确定'}}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `,methods:{hideUpload(n){const e=this.$root;e.upload.isUploading||e.stopUploading()}}}),Vue.component("loading",{template:`\n    <div id="loading"\n      :style="{zIndex: $root.zIndex + 10}"\n    >\n      <div class="box">\n        <div class="ball" v-html="ballHtml"></div>\n        <div class="c">loading...</div>\n      </div>\n    </div>\n  `,data:()=>({ballHtml:new Array(2).fill().map(function(n,e){return'<ul class="'+(0===e?"h":"v")+'">'+new Array(10).fill().map(function(n,t){return'<li style="transform: rotate'+(0===e?"X":"Y")+"("+30*t+'deg)"></li>'}).join("")+"</ul>"}).join("")})}),Vue.component("panel-alert",{template:`\n    <div id="alert" class="modal fade in"\n      :style="{zIndex: $root.zIndex + 10}"\n      @click="$root.alert.isDisplay=false"\n    >\n      <div class="modal-dialog modal-sm" @click.stop>\n        <div class="modal-content">\n          <div class="modal-header">\n            <h4 class="modal-title">\n              <i class="glyphicon glyphicon-info-sign"></i>\n              <span>提示</span>\n            </h4>\n          </div>\n          <div class="modal-body">\n            <div>{{$root.alert.msg}}</div>\n          </div>\n        </div>\n      </div>\n    </div>\n  `});</script><script>!function(e){function t(){const t=e("#web-ftp .select-rect");a=e("#web-ftp .dir-list"),i=a.children().eq(vm.curDirIndex),a.on("mousedown",function(r){const o=e(r.target);if(o.is(":focus")||o.closest(".gray-title .glyphicon")[0])return;const n=o.closest(".resize"),l=o.closest(".gray-title"),c=o.closest(".auto-scroll"),p=o.closest(".file-list"),u=r.clientX,d=r.clientY;let m,f,h,v;e(":focus").blur(),i=o.closest(".dir").each((e,t)=>{m=t.offsetLeft,f=t.offsetTop,h=t.offsetWidth,v=t.offsetHeight}),vm.curDirIndex=parseInt(i.attr("dir-index"));for(let e=0,t=vm.dirList.length;e<t;e++)if(vm.dirList[e]!==vm.dir&&vm.dir.css.zIndex<=vm.dirList[e].css.zIndex){vm.dir.css.zIndex=++vm.zIndex;break}l.each((e,t)=>{if(r.preventDefault(),i.css("transition","none"),r.altKey){let e=JSON.parse(JSON.stringify(vm.dir));e.uid=g.createUid(),vm.dirList.splice(vm.curDirIndex+1,0,e),vm.curDirIndex++,vm.$nextTick(()=>{i=a.children().eq(vm.curDirIndex).css("transition","none")})}document.onmousemove=(e=>{const t=e.clientX,r=e.clientY;let s=t-u+m,a=r-d+f;s<0&&(s=0),a<0&&(a=0),i.css({left:s+"px",top:a+"px"})}),document.onmouseup=(e=>{document.onmousemove=document.onmouseup=null,i.each((e,t)=>{vm.dir.css={left:t.offsetLeft+"px",top:t.offsetTop+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px",zIndex:vm.dir.css.zIndex}}),a.children().css("transition","")})}),n.each((e,t)=>{r.preventDefault();const s=o.attr("class"),a=s.indexOf("l")>-1,n=s.indexOf("t")>-1,l={l:["left","width"],t:["top","height"],r:["width"],b:["height"],lt:["left","top","width","height"],rt:["top","width","height"],rb:["width","height"],lb:["left","width","height"]}[s],c=i[0];i.css({transition:"none"}),document.onmousemove=(e=>{const t=e.clientX,i=e.clientY,r={};a&&(r.left=t-u+m),n&&(r.top=i-d+f),r.width=(a?u-t:t-u)+h,r.height=(n?d-i:i-d)+v,r.width<200&&(a&&(r.left=m+h-200),r.width=200),r.height<200&&(n&&(r.top=f+v-200),r.height=200),r.left<0&&(a&&(r.width+=r.left),r.left=0),r.top<0&&(n&&(r.height+=r.top),r.top=0),l.forEach((e,t)=>{c.style[e]=r[e]+"px"})}),document.onmouseup=(e=>{document.onmousemove=document.onmouseup=null,i.each((e,t)=>{vm.dir.css={left:t.offsetLeft+"px",top:t.offsetTop+"px",width:t.offsetWidth+"px",height:t.offsetHeight+"px",zIndex:vm.dir.css.zIndex}}),i.css({transition:""})})}),p.each((a,n)=>{function l(t){e(t.target);const i=t.clientX,r=t.clientY;if(!(D=D||!!(i-u)||!!(r-d)))return;if(clearTimeout(vm.timer.autoScroll),t.clientY<h.top||t.clientY>h.bottom){const e=t.clientY<h.top,i=e?t.clientY-h.top:t.clientY-h.bottom;m.scrollTop+=i,vm.timer.autoScroll=setTimeout(()=>{l({clientX:t.clientX,clientY:t.clientY,ctrlKey:g.isCtrlKey(t),shiftKey:t.shiftKey,altKey:t.altKey})},17)}const s=i-h.left+m.scrollLeft,a=r-h.top+m.scrollTop;let o=Math.min(v,s),n=Math.min(b,a),c=Math.abs(v-s),p=Math.abs(b-a);o<0&&(c+=o,o=0),n<0&&(p+=n,n=0),c>m.scrollWidth-o&&(c=m.scrollWidth-o),p>m.scrollHeight-n&&(p=m.scrollHeight-n),f.style.left=o+"px",f.style.top=n+"px",f.style.width=c+"px",f.style.height=p+"px",f.style.display="block";let y=o+c,w=n+p;for(let e=0,i=x.length;e<i;e++){const i=x[e],r=i.li,s=!(o>i.r||n>i.b||y<i.l||w<i.t);g.isCtrlKey(t)?r.setAttribute("draggable",s?!i.ctrlSign:i.ctrlSign):t.shiftKey?(r.setAttribute("draggable",s||i.shiftSign),s&&delete i.shiftSign):r.setAttribute("draggable",s)}}function p(r,a){const o=e(r.target).closest(".file");clearTimeout(vm.timer.autoScroll),document.onmousemove=document.onmouseup=null,t.hide(),D?i.find(".file[draggable=true]:eq(0)").each((t,i)=>{s=e(i)}):g.isCtrlKey(r)?o.each((e,t)=>{s=o,t.setAttribute("draggable",!("true"===t.getAttribute("draggable")))}):r.shiftKey?o.each((t,r)=>{const a=(s=e.contains(i[0],s[0])?s:i.find(".file:eq(0)")).attr("file-index"),o=r.getAttribute("file-index"),n=Math.min(a,o),l=Math.max(a,o);y.forEach((e,t)=>{e.setAttribute("draggable",t>=n&&t<=l)})}):a||(y.forEach((e,t)=>{e.setAttribute("draggable","false")}),o[0]&&(s=o.attr("draggable","true")))}i[0];const m=c[0],f=t[0],h=m.getBoundingClientRect(),v=u-h.left+m.scrollLeft,b=d-h.top+m.scrollTop;let y=[].slice.call(m.querySelectorAll(".dir-list li")),x=[],D=!1;if("true"===o.attr("draggable")){const e=o.closest(".file");"true"!==e.attr("draggable")||g.isCtrlKey(r)||r.shiftKey?p(r):3!==r.which&&(document.onmouseup=p),3===r.which&&(s=e)}else r.preventDefault(),x=y.map((e,t)=>{const i="true"===e.getAttribute("draggable");return!i||g.isCtrlKey(r)||r.shiftKey||e.setAttribute("draggable","false"),{l:e.offsetLeft,t:e.offsetTop,r:e.offsetLeft+e.offsetWidth,b:e.offsetTop+e.offsetHeight,ctrlSign:g.isCtrlKey(r)&&i,shiftSign:r.shiftKey&&i,li:e}}),t.appendTo(c),document.onmousemove=l,document.onmouseup=(e=>{p(e,3===e.which)})})}).on("dblclick",".file",function(e){e.preventDefault(),vm.exec(e,"打开")}).on("contextmenu",".file-list",function(t){t.preventDefault();let r=t.clientX,s=t.clientY;const a=i.find(".file[draggable=true]");"true"===e(t.target).attr("draggable")?vm.menu.list=["打开","复制","剪切","粘贴","重命名","删除",1===a.length&&"true"!==a.attr("is-dir")?"下载":"下载zip"]:vm.menu.list=["新建文件夹","上传文件","上传文件夹",vm.clipboard.pathFrom?"粘贴":""],vm.$nextTick(()=>{e("#menu").show();let t=e("#menu").width(),i=e("#menu").height();r+t>document.documentElement.clientWidth&&(r=document.documentElement.clientWidth-t),s+i>document.documentElement.clientHeight&&(s=document.documentElement.clientHeight-i),e("#menu").css({left:r+"px",top:s+"px"})})}).on("dragstart",".file-list",function(t){const s=t.originalEvent,a=i.find(".file[draggable=true]");let o="",n="",l="";if(r=e(t.target).closest(".file"),1===a.length){let e=a.find(".file-name").html();"true"===a.attr("is-dir")?(o=e+".zip",n="zip",l="打包下载"):(o=e,n=(e.match(/\.(\w+)$/)||[])[1]||"text",l="下载")}else o="download.zip",n="zip",l="打包下载";const c=[];a.each((e,t)=>{c.push(t.getAttribute("filename"))});let p="application/"+n+":"+o+":"+vm.curApp.url+"?"+g.json2URL({a:l,secretVal:vm.getUrlReport(vm.curApp).secretVal,pathDir:vm.dir.path,filenames:JSON.stringify(c)});vm.exec(t,t.altKey?"复制":"剪切","not preventDefault"),s.dataTransfer.setData("DownloadURL",p),s.dataTransfer.setData("text","http:codding.cn/blog.html")}).on("dragover",function(t){return a.children().removeClass("dragover"),e(t.target).closest(".dir").addClass("dragover"),clearTimeout(vm.timer.dragover),vm.timer.dragover=setTimeout(function(){a.children().removeClass("dragover")},200),!1}).on("drop",function(t){const i=t.originalEvent,s=e(t.target);return t.preventDefault(),i.stopImmediatePropagation(),a.find(".cut").removeClass("cut"),vm.curDirIndex=parseInt(s.closest(".dir").attr("dir-index")),vm.dir.css.zIndex=++vm.zIndex,r[0]?vm.exec(t,"粘贴"):(g.getFileFromDataTransfer(i.dataTransfer,e=>{o=e,vm.fileUpload()}),a.find(".cut").removeClass("cut")),r=e(),!1}),n.onchange=l.onchange=function(){const e=this;o=[].slice.call(this.files).map((t,i)=>(t.fullPath="/"+(e===n?t.name:t.webkitRelativePath),t)),vm.fileUpload()};const c={8:"backspace",9:"tab",13:"enter",27:"esc",35:"end",36:"home",38:"up",39:"right",40:"bottom",46:"delete",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",113:"f2"};e(document).on("click",t=>{e("#menu").hide()}).on("copy",t=>{e(t.target).is(":focus")||vm.exec(t,"复制","not preventDefault")}).on("cut",t=>{e(t.target).is(":focus")||vm.exec(t,"剪切","not preventDefault")}).on("paste",e=>{if(vm.clipboard.pathFrom)vm.exec(e,"粘贴");else{const t=e.originalEvent,i=t.clipboardData.items[0].getAsFile();i&&(i.fullPath="/"+(new Date).getTime()+".png",o=[i],vm.fileUpload())}}).on("dragover",function(e){e.preventDefault()}).on("drop",function(e){e.stopImmediatePropagation(),e.originalEvent.preventDefault()}).on("keydown",t=>{const r=c[t.keyCode],s=g.isCtrlKey(t);if("esc"===r&&(vm.router.open.isDisplay=vm.router.newDir.isDisplay=vm.router.config.isDisplay=vm.rename.isDisplay=!1,vm.freeView.imgList=[]),i=a.children().eq(vm.curDirIndex),!e(t.target).is(":focus"))if(s&&t.shiftKey&&t.altKey)r;else if(s&&t.shiftKey)r;else if(s&&t.altKey)switch(r){case"a":vm.clipboard={};break;case"f":vm.exec(t,"自动排版")}else if(t.shiftKey&&t.altKey)r;else if(s)switch(r){case"a":vm.exec(t,"全选");break;case"q":vm.exec(t,"选中路径");break;case"y":vm.exec(t,"前进");break;case"z":vm.exec(t,"后退")}else if(t.shiftKey)r;else if(t.altKey)switch(r){case"w":case"x":vm.dirList.splice(vm.curDirIndex,1);break;case"o":vm.router.open.isDisplay=!0;break;case"n":vm.exec(t,"新建文件夹");break;case"m":vm.router.config.isDisplay=!0}else switch(r){case"delete":vm.exec(t,"删除");break;case"backspace":vm.exec(t,"后退");break;case"enter":vm.exec(t,"打开");break;case"f2":vm.exec(t,"重命名")}})}Vue.config.silent=!0,Vue.config.devtools=!0;let i=e(),r=e(),s=e(),a=e(),o=[];const n=document.createElement("input"),l=document.createElement("input");n.type=l.type="file",n.setAttribute("multiple","true"),l.setAttribute("webkitdirectory","true"),window.vm=new Vue({el:"#web-ftp",data:()=>({zIndex:0,debounce:0,router:{config:{isDisplay:!1,curAppIndex:0,appList:[{url:"http://localhost/web-ftp/src/php/webFtp.php",eye:!1,curDirIndex:0,secretKey:"",dirList:[]}]},newDir:{isDisplay:!1,name:""},open:{isDisplay:!1,path:""}},rename:{isDisplay:!1,name:""},is:{mac:navigator.userAgent.indexOf("Mac OS")>-1,isUploadDirSupport:"webkitdirectory"in l,loading:!1},freeView:{isDisplay:!0,left:0,top:0,scale:1,rotate:0,curIndex:0,imgList:[]},alert:{isDisplay:!1,msg:"找不到相关目录"},urlReport:{},path2File:{},clipboard:{isCopy:!1,pathFrom:"c:/phpStudy",filenames:[]},menu:{list:["复制","剪切","粘贴"]},timer:{dragover:0,autoScroll:0,changeHash:0},upload:{msg:"",isUploading:!1,sizeTotal:0,sizeUploaded:0,sizeUploading:0,errReport:[]},mapType:{bmp:"picture",tiff:"picture",gif:"picture",jpeg:"picture",jpg:"picture",svg:"picture",png:"picture",rm:"film",rmvb:"film",wmv:"film",avi:"film",mp4:"film","3gp":"film",mkv:"film",cd:"music",ogg:"music",mp3:"music",wma:"music",wav:"music",mp3pro:"music",rm:"music",real:"music",ape:"music",module:"music",midi:"music",vqf:"music"}}),computed:{config(){return this.router.config},appList(){return this.config.appList||[]},curApp(){return this.appList[this.curAppIndex]||{}},dirList(){return this.curApp.dirList||[]},dir(){return this.dirList[this.curDirIndex]||{}},curAppIndex:{get(){let e=this.config.curAppIndex,t=this.appList.length;return(e%t+t)%t},set(e){this.config.curAppIndex=e}},curDirIndex:{get(){let e=this.curApp.curDirIndex,t=this.dirList.length;return e<0||e>t-1?t-1:e},set(e){this.curApp.curDirIndex=e}}},watch:{router:{deep:!0,handler(e){const t=this;clearTimeout(t.timer.changeHash),t.timer.changeHash=setTimeout(()=>{location.hash=JSON.stringify(e)},t.debounce||10),t.debounce=0}},"rename.isDisplay":function(t){t&&vm.$nextTick(()=>{e(".modal:visible .form-control:eq(0)").each((e,t)=>{t.focus(),t.select()})})}},methods:{routerInit(){const t=this;let i={};try{i=JSON.parse(location.hash.substring(1))}catch(e){bug("router parse err")}i.config=i.config||{},i.config=i.config||{},i.config.isDisplay=i.config.isDisplay||!1,i.config.curAppIndex=i.config.curAppIndex||0,i.config.appList=i.config.appList||[],i.newDir=i.newDir||{},i.newDir.isDisplay=i.newDir.isDisplay||!1,i.newDir.name=i.newDir.name||"",i.open=i.open||{},i.open.isDisplay=i.open.isDisplay||!1,i.open.path=i.open.path||"",0===i.config.appList.length&&i.config.appList.push({url:"http://codding.cn/webFtp.php",eye:!1,curDirIndex:0,secretKey:"",dirList:[]}),t.router=i,t.checkReport(()=>{t.openAllDir()}),(i.config.isDisplay||i.open.isDisplay||i.newDir.isDisplay)&&setTimeout(()=>{e(":focus").is(".form-control")||e(".modal .form-control:eq(0)").focus()},100)},urlFormat:e=>e.replace(/(\\|\/)+/g,"/").replace(/\/+$/,""),getWrapFilesKey(e){return this.curApp.url+"-"+this.curApp.secretKey+"-"+e.path},getFiles(e){return this.path2File[this.getWrapFilesKey(e)]||[]},getBinaryFiles:()=>o,getUrlReport(e){return this.urlReport[e.url+"-"+e.secretKey]||{}},updateDirPath(e,t){const i=e.target,r=vm.urlFormat(i.value);i.value=t.path=r,i.blur()},stopUploading(){o=[],this.upload={msg:"",isUploading:!1,sizeTotal:0,sizeUploaded:0,sizeUploading:0,errReport:[]}},blankBinaryFiles(){this.upload.errReport=[],o=[]},submitRename(t){const r=this,a=i.find(".file[draggable=true]"),o={dir:0,file:0},n={a:"重命名",secretVal:r.getUrlReport(r.curApp).secretVal,pathFrom:r.dir.path,pathTo:r.dir.path,from:[],to:[]},l=r.rename.name.replace(/\.[^.]*$/,"");a.each((e,t)=>{const i=t.getAttribute("filename"),a=t.getAttribute("filetype"),c=(t.getAttribute("basename"),"true"===t.getAttribute("is-dir"));n.from.push(i),t===s[0]?n.to.push(r.rename.name):n.to.push(l+"("+(c?++o.dir:++o.file)+")"+(a?"."+a:""))}),n.from=JSON.stringify(n.from),n.to=JSON.stringify(n.to),e.post(r.curApp.url,n,e=>{r.path2File={},r.openAllDir(),r.rename.name="",r.rename.isDisplay=!1})},async fileUpload(e){const t=vm.getUrlReport(vm.curApp);for(vm.upload={uploadMsg:"",isUploading:!0,sizeTotal:0,sizeUploaded:0,sizeUploading:0,errReport:[]},o.sort((e,t)=>t.size-e.size),o.forEach((e,t)=>{vm.upload.sizeTotal+=e.size});o.length;){const e=o.shift();e.size>t.uploadMaxSize_?(vm.upload.sizeUploaded+=e.size,vm.upload.errReport.push({code:2,name:e.name,msg:"上传失败，服务器限制文件上传最大不得超过 "+t.uploadMaxSize})):await new Promise((i,r)=>{const s=new FormData;s.append("a","文件上传"),s.append("pathDir",vm.dir.path),s.append("name",e.fullPath),s.append("file",e),s.append("secretVal",t.secretVal);const a=new XMLHttpRequest;a.open("POST",vm.curApp.url,!0),a.upload.onprogress=(t=>{vm.upload.msg=o.length+"个文件等待中， 正在上传 "+e.name+" / ",vm.upload.sizeUploading=t.loaded}),a.onload=a.onerror=(t=>{let r={};vm.upload.sizeUploaded+=e.size,"error"===t.type&&vm.upload.errReport.push({name:e.name,msg:"上传失败，也许是权限问题"});try{r=JSON.parse(a.responseText)}catch(t){r={code:2,msg:"上传失败，后台异常"}}r.name=e.name,r.code&&vm.upload.errReport.push(r),i(a.responseText)}),a.send(s)})}vm.path2File={},vm.upload.isUploading=!1,vm.upload.msg="",vm.openAllDir(),e&&e()},async checkReport(t){const i=this;for(let t=0,r=i.appList.length;t<r;t++){let r=i.appList[t],s=r.url+"-"+r.secretKey;if(r.url&&!i.urlReport[s]){i.$set(i.urlReport,s,{isLoading:!0});try{let{token:t}=await new Promise((t,i)=>{e.ajax({url:r.url,method:"post",dataType:"json",data:{a:"getToken"},success:t,error:i})}),a=CryptoJS.SHA256(r.secretKey+t).toString(),o=await new Promise((t,i)=>{e.post(r.url,{a:"接口探测",secretVal:a},e=>{t(e)},"json")});o.code||(o.secretVal=a,o.uploadMaxSize_=1024*o.uploadMaxSize.match(/\d+/)*1024),i.urlReport[s]=o}catch(e){i.urlReport[s]={code:2,msg:"接口地址异常"}}}}t&&t()},async openAllDir(t){const i=this,r=this.getUrlReport(this.curApp);if(r.secretVal)for(let t=0,s=i.dirList.length;t<s;t++){const s=i.dirList[t],a=i.getWrapFilesKey(s);i.path2File[a]||(i.$set(i.path2File,a,[]),i.path2File[a]=await new Promise((t,a)=>{e.post(i.curApp.url,{a:"获取文件列表",pathDir:s.path||"/",secretVal:r.secretVal},e=>{e.code||(e.sort((e,t)=>e.isDir===t.isDir?e.name.localeCompare(t.name):t.isDir.toString().localeCompare(e.isDir.toString())),e.forEach((e,t)=>{e._mtime=new Date(1e3*e.mtime).date(),e.type=!e.isDir&&e.name.indexOf(".")>-1?e.name.substring(e.name.lastIndexOf(".")+1).toLowerCase():""})),t(e)},"json")}))}else bug("接口不通，不请求")},exec(t,r,o){const c=this;!o&&t.preventDefault();let p=c.getUrlReport(c.curApp);switch(r){case"自动排版":{let e=Math.ceil(document.documentElement.clientWidth/500),t=Math.floor((document.documentElement.clientWidth-10)/e-10),i=-1;c.dirList.forEach((r,s)=>{i++,r.css.width=r.css.height=t+"px",r.css.left=(t+10)*(i%e)+10+"px",r.css.top=(t+10)*Math.floor(i/e)+10+"px"})}break;case"打开":{const r=[],s=c.getFiles(c.dir),a={};i.find(".file[draggable=true]").each((e,t)=>{const i="true"===t.getAttribute("is-dir");t.getAttribute("file-index");if(i){let e=JSON.parse(JSON.stringify(c.dir));e.path+="/"+t.getAttribute("filename"),r.push(e)}else a.pic=a.pic||c.mapType[t.getAttribute("filetype")]});let o=e(t.target).closest(".file");if(a.pic){let e=o.attr("filename");s.forEach((t,i)=>{"picture"===c.mapType[t.type]&&c.freeView.imgList.push(t),t.name===e&&(c.freeView.curIndex=c.freeView.imgList.length-1)})}r.length>0&&(r.forEach((e,t)=>{e.uid=g.createUid(),e.css.left=parseInt(e.css.left)+34*t+"px",e.css.top=parseInt(e.css.top)+34*t+"px"}),c.dirList.splice(c.curDirIndex,1,...r),c.curDirIndex=c.curDirIndex+r.length-1)}break;case"新建文件夹":if(!c.dir.path)return;c.router.newDir.isDisplay=!0;break;case"全选":s=i.find("li").attr("draggable","true").eq(0);break;case"复制":case"剪切":{a.find(".cut").removeClass("cut");let t=c.clipboard={isCopy:"复制"===r,pathFrom:c.dir.path,filenames:[]};i.find(".file[draggable=true]").each((i,r)=>{t.filenames.push(r.getAttribute("filename")),e(r)[t.isCopy?"removeClass":"addClass"]("cut")})}break;case"粘贴":{let t=c.clipboard;if(!t.pathFrom)return;if(p.code||c.getFiles(c.dir).code)return bug("当前路径不是目录 "+c.dir.path),void(c.clipboard={});if(t.pathFrom===c.dir.path)return bug("同一目录，不需要移动"),void(c.clipboard={});e.post(c.curApp.url,{a:t.isCopy?"复制":"重命名",secretVal:p.secretVal,pathFrom:t.pathFrom,pathTo:c.dir.path,from:JSON.stringify(t.filenames),to:JSON.stringify(t.filenames)},e=>{c.clipboard={},c.path2File={},c.openAllDir()})}break;case"前进":history.forward();break;case"后退":history.back();break;case"选中路径":i.find(".gray-title .form-control:eq(0)").focus().each((e,t)=>{t.select&&t.select()});break;case"删除":{let t={a:"删除文件",secretVal:p.secretVal,pathDir:c.dir.path,filenames:[]};i.find(".file[draggable=true]").each((e,i)=>{t.filenames.push(i.getAttribute("filename"))}),t.filenames=JSON.stringify(t.filenames),e.post(c.curApp.url,t,function(e){c.path2File={},c.openAllDir()},"json")}break;case"重命名":if(!e.contains(i[0],s[0]))return;c.rename.name=s.attr("filename"),c.rename.isDisplay=!0;break;case"下载":location=c.curApp.url+"?"+g.json2URL({a:"下载",secretVal:p.secretVal,pathDir:c.dir.path,filenames:JSON.stringify([i.find(".file[draggable=true]").eq(0).attr("filename")])});break;case"下载zip":{const e=[];i.find(".file[draggable=true]").each((t,i)=>{e.push(i.getAttribute("filename"))}),location=c.curApp.url+"?"+g.json2URL({a:"打包下载",secretVal:p.secretVal,pathDir:c.dir.path,filenames:JSON.stringify(e)})}break;case"上传文件":n.click();break;case"上传文件夹":l.click()}}},mounted(){const e=this;e.routerInit(),window.top.addEventListener("hashchange",t=>{e.routerInit()},!1),e.dirList.forEach((t,i)=>{e.zIndex=Math.max(t.css.zIndex,e.zIndex)}),document.body.style.display="",e.$nextTick(t)}})}(window.jQuery);</script></body></html>